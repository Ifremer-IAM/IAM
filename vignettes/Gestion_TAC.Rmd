---
title: "Gestion avec TAC"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Gestion avec TAC}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
# bibliography: vignette.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r library}
library(IAM)
```


Le modèle bio-économique IAM a été développé dans l'optique d'être utilisé pour des scénarios de gestion de quotats. Ainsi, des scénarios de Gestion par TAC peuvent être introduit à différentes échelles. Ce document traite de la gestion de TAC à un niveau interflotilles puis une autre partie détaillera la gestion intra flotilles.

L'ensemble de ces simulations sera réalisé avec le jeu de donnée example `Ifremer` composé de 7 flotilles et deux 3 espèces dynamiques dont une espèce à dynamique SS3.

```{r inport, eval=FALSE, results="hide"}
load(IAM_example("IAM_SS3_1984.RData"))
IAM_input_1984 <- IAM::IAM.input(
  fileIN = IAM_example("inputFile.xlsx"),
  t_init = 1984, nbStep = 12, folderFleet = IAM_example("fleets"),
  Fq_i = list(DAR = iniFq_i), iniFq_i = list(DAR = iniFq_i),
  Fq_fmi = list(DAR = iniFq_fmi), iniFq_fmi = list(DAR = iniFq_fmi),
  FqLwt_i = list(DAR = iniFqLwt_i), iniFqLwt_i = list(DAR = iniFqLwt_i),
  FqLwt_fmi = list(DAR = iniFqLwt_fmi), iniFqLwt_fmi = list(DAR = iniFqLwt_fmi),
  FqDwt_i = list(DAR = iniFqDwt_i), iniFqDwt_i = list(DAR = iniFqDwt_i),
  FqDwt_fmi = list(DAR = iniFqDwt_fmi), iniFqDwt_fmi = list(DAR = iniFqDwt_fmi),
  Nt0s1q = list(DAR = Nt0s1q), Ni0q = list(DAR = Ni0q),
  iniNt0q = list(DAR = iniNt0q), matwt = list(DAR = mat_morphage)
)
summary(IAM_input_1984)
```


```{r falseinport, echo = FALSE}
data("IAM_input_1984")
summary(IAM_input_1984)
```

L'objet argument est laissé tel quel lors de l'utilisation de l'interface et sera édité à la main plus tard pour chaque scénario.

```{r argum, eval=FALSE}
IAM_argum_1984 <- IAM.args(IAM_input_1984)
```

```{r falseargum, echo = FALSE}
data("IAM_argum_1984")
```

## Besoin d'un scénario *statu quo*

Afin de pouvoir comparer l'effet de chaque scénario, il nous faut un scénario de départ dans lequel aucune mesure de Gestion s'imposera.

Dans un premier temps il est utile de définir les dynamiques de recrutements ainsi que des éléments de paramétrage du module économique. On va pour cela éditer l'objet `IAM_argum_1984`

```{r edit argum}
# Module SR
# TODO add boken stick Rec

# Module EcoDCF
IAM_argum_1984 <- IAM.editArgs_Eco(IAM_argum_1984, dr = 0.04, perscCalc = 1)

# Module Gestion
mfm <- with(IAM_input_1984@input$Fleet,{
  (effort1_f_m * effort2_f_m * nbv_f_m) / as.vector(effort1_f * effort2_f * nbv_f)
})
mfm[is.na(mfm)] <- 0

IAM_argum_1984 <- IAM.editArgs_Gest(IAM_argum_1984, active = FALSE, 
                                    delay = 1, mfm = mfm)
# Module Scenario
IAM_argum_1984 <- IAM.editArgs_Scenar(IAM_argum_1984)
```


```{r statuquo, eval=FALSE}
sim_statu_quo <- IAM::IAM.model(objArgs = IAM_argum_1984, objInput = IAM_input_1984)
```


## Gestion TAC générale

Les différentes options de réglages du module Gestion sont exposées dans la vignette "Utilisation IAM dans R". Il s'agit ici de les explorer plus en avant et de les utiliser.

```{r editargum, eval = FALSE}

# IAM_argum_1984_TAC <- IAM.args(IAM_argum_1984)

IAM_argum_1984 <- IAM.editArgs_Gest(
  IAM_argum_1984, active = TRUE, control = "Nb vessels", target = "TAC",
  espece = "COR", delay = 2, type = "x", update = TRUE, bounds = c(100, -100), # X2 a -100 entraine des flottes a 0 navires !
  c(NA, 3300, 3250, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200, 3200))
#   84, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995

```



```{r TAC, eval = FALSE}
sim_TACglob <- IAM::IAM.model(objArgs = IAM_argum_1984_TAC, objInput = IAM_input_1984,
                              verbose = TRUE, force_t = 7)
```

## Gestion TAC par flotille



<!-- ## References -->

<!-- <div id="refs"></div> -->

